<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GFFI Particle Shapes</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle at top,#06061a,#000);
  font-family:'Orbitron',sans-serif;
}
#title{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:3em;
  color:#00ffff;
  text-shadow:0 0 20px #00ffff,0 0 80px #00ffff;
  pointer-events:none;
}
#ui{
  position:fixed;
  bottom:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  padding:10px 14px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(14px);
  border-radius:18px;
}
button{
  background:#00ffff;
  border:none;
  border-radius:10px;
  padding:6px 10px;
  font-family:inherit;
  cursor:pointer;
}
@media(max-width:768px){
  #title{font-size:2.2em}
}
</style>
</head>

<body>

<div id="title">GFFI</div>

<div id="ui">
  <button onclick="setShape('galaxy')">Galaxy</button>
  <button onclick="setShape('sphere')">Sphere</button>
  <button onclick="setShape('cube')">Cube</button>
  <button onclick="setShape('spiral')">Spiral</button>
  <button onclick="setShape('love')">Love</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ===== THREE ===== */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
camera.position.z=160;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

/* ===== PARTICLES ===== */
const COUNT=4000;
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
let target=new Float32Array(COUNT*3);

geo.setAttribute("position",new THREE.BufferAttribute(pos,3));

const mat=new THREE.PointsMaterial({
  color:0x00ffff,
  size:1.3,
  transparent:true,
  opacity:.9
});

const points=new THREE.Points(geo,mat);
scene.add(points);

/* ===== SHAPES ===== */
function shapeGalaxy(){
  for(let i=0;i<COUNT;i++){
    const r=Math.random()*70;
    const a=Math.random()*Math.PI*2;
    target[i*3]=Math.cos(a)*r;
    target[i*3+1]=(Math.random()-.5)*40;
    target[i*3+2]=Math.sin(a)*r;
  }
}
function shapeSphere(){
  for(let i=0;i<COUNT;i++){
    const u=Math.random();
    const v=Math.random();
    const t=2*Math.PI*u;
    const p=Math.acos(2*v-1);
    const r=60;
    target[i*3]=r*Math.sin(p)*Math.cos(t);
    target[i*3+1]=r*Math.sin(p)*Math.sin(t);
    target[i*3+2]=r*Math.cos(p);
  }
}
function shapeCube(){
  for(let i=0;i<COUNT;i++){
    target[i*3]=(Math.random()-.5)*100;
    target[i*3+1]=(Math.random()-.5)*100;
    target[i*3+2]=(Math.random()-.5)*100;
  }
}
function shapeSpiral(){
  for(let i=0;i<COUNT;i++){
    const a=i*0.1;
    target[i*3]=Math.cos(a)*a*1.2;
    target[i*3+1]=(Math.random()-.5)*20;
    target[i*3+2]=Math.sin(a)*a*1.2;
  }
}
function shapeLove(){
  for(let i=0;i<COUNT;i++){
    const t=Math.random()*Math.PI*2;
    const x=16*Math.pow(Math.sin(t),3);
    const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    target[i*3]=x*3;
    target[i*3+1]=y*3;
    target[i*3+2]=(Math.random()-.5)*20;
  }
}

/* ===== SHAPE CONTROL ===== */
function setShape(s){
  if(s==="galaxy")shapeGalaxy();
  if(s==="sphere")shapeSphere();
  if(s==="cube")shapeCube();
  if(s==="spiral")shapeSpiral();
  if(s==="love")shapeLove();
}
setShape("galaxy");

/* ===== GESTURE ===== */
let scaleTarget=1;
let swipeX=null;

const video=document.createElement("video");
video.style.display="none";
document.body.appendChild(video);

const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
hands.setOptions({maxNumHands:1,minDetectionConfidence:.6,minTrackingConfidence:.6});

const shapes=["galaxy","sphere","cube","spiral","love"];
let shapeIndex=0;

hands.onResults(r=>{
  if(!r.multiHandLandmarks.length)return;
  const h=r.multiHandLandmarks[0];
  const d=Math.hypot(h[4].x-h[8].x,h[4].y-h[8].y);
  scaleTarget=THREE.MathUtils.clamp(d*6,.6,3);

  if(!swipeX) swipeX=h[0].x;
  if(h[0].x-swipeX>.25){
    shapeIndex=(shapeIndex+1)%shapes.length;
    setShape(shapes[shapeIndex]);
    swipeX=null;
  }
  if(swipeX-h[0].x>.25){
    shapeIndex=(shapeIndex-1+shapes.length)%shapes.length;
    setShape(shapes[shapeIndex]);
    swipeX=null;
  }
});

new Camera(video,{
  onFrame:async()=>hands.send({image:video}),
  width:640,height:480
}).start();

/* ===== ANIMATE ===== */
function animate(){
  requestAnimationFrame(animate);

  points.scale.lerp(
    new THREE.Vector3(scaleTarget,scaleTarget,scaleTarget),
    .08
  );

  for(let i=0;i<COUNT;i++){
    const x=i*3;
    pos[x]+= (target[x]-pos[x])*.05;
    pos[x+1]+= (target[x+1]-pos[x+1])*.05;
    pos[x+2]+= (target[x+2]-pos[x+2])*.05;
  }

  geo.attributes.position.needsUpdate=true;
  points.rotation.y+=.002;
  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>